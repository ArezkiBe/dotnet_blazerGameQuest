@*
    Page principale de jeu
    Contient la logique d'interaction avec les salles de donjon
    G√®re les actions : Combattre, Fuir, Fouiller
*@
@page "/game"

<div class="game-container">
    <h1>Salle de Jeu - Donjon</h1>
    
    <div class="game-status">
        <div class="player-stats">
            <h3>√âtat du Joueur</h3>
            <p><strong>Nom :</strong> Aventurier</p>
            <p><strong>Points :</strong> 0</p>
            <p><strong>Salle :</strong> 1 / 5</p>
        </div>
    </div>

    <div class="room-display">
        <div class="room-description">
            <h2>üè∞ Salle 1 : L'Entr√©e du Donjon</h2>
            <div class="room-story">
                <p>Vous p√©n√©trez dans une salle humide aux murs de pierre ancienne. 
                   Des torches vacillantes projettent des ombres inqui√©tantes sur les murs couverts de mousse.</p>
                   
                <p>Soudain, un <strong>gobelin</strong> surgit des ombres, brandissant une √©p√©e rouill√©e !</p>
                
                <p class="encounter-text">üíÄ <em>Un gobelin vous barre la route !</em></p>
            </div>
        </div>

        <div class="room-actions">
            <h3>Que faites-vous ?</h3>
            
            <div class="action-buttons">
                <button class="btn btn-danger action-btn" @onclick="@(() => TakeAction("combat"))">
                    ‚öîÔ∏è Combattre
                    <small>Risqu√© mais plus de points</small>
                </button>
                
                <button class="btn btn-warning action-btn" @onclick="@(() => TakeAction("flee"))">
                    üèÉ Fuir
                    <small>S√ªr mais moins de points</small>
                </button>
                
                <button class="btn btn-info action-btn" @onclick="@(() => TakeAction("search"))">
                    üîç Fouiller
                    <small>Chance de tr√©sor ou pi√®ge</small>
                </button>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(actionResult))
        {
            <div class="action-result">
                <div class="alert alert-info">
                    <h4>R√©sultat de l'action :</h4>
                    <p>@actionResult</p>
                    
                    <div class="next-actions">
                        <button class="btn btn-primary" @onclick="NextRoom">
                            Passer √† la salle suivante
                        </button>
                        <button class="btn btn-secondary" @onclick="ResetRoom">
                            Refaire cette salle
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@code {
    /// <summary>
    /// R√©sultat de la derni√®re action effectu√©e par le joueur
    /// Affich√© dans la section des r√©sultats d'action
    /// </summary>
    private string actionResult = "";
    
    /// <summary>
    /// Traite l'action choisie par le joueur dans la salle de donjon
    /// </summary>
    /// <param name="action">Type d'action : "combat", "flee", ou "search"</param>
    private void TakeAction(string action)
    {
        // Traitement des diff√©rentes actions possibles
        switch (action.ToLower())
        {
            case "combat":
                // Action combattre : risqu√© mais plus de points
                actionResult = "‚öîÔ∏è Vous attaquez le gobelin avec courage ! Apr√®s un combat acharn√©, vous le vainquez. Vous gagnez 15 points !";
                break;
            case "flee":
                // Action fuir : s√ªr mais moins de points
                actionResult = "üèÉ Vous fuyez prudemment vers la sortie de la salle. Vous √©vitez le danger mais ne gagnez que 5 points.";
                break;
            case "search":
                // Action fouiller : chance de tr√©sor ou pi√®ge
                actionResult = "üîç Vous fouillez la salle et trouvez un coffre cach√© ! √Ä l'int√©rieur, une potion de soin et 10 pi√®ces d'or. Vous gagnez 12 points !";
                break;
        }
    }
    
    /// <summary>
    /// Avance vers la salle suivante du donjon
    /// Version 1 : Affiche un message, fonctionnalit√© compl√®te √† venir en Version 2
    /// </summary>
    private void NextRoom()
    {
        actionResult = "üö™ Vous avancez vers la salle suivante... (Fonctionnalit√© √† venir)";
    }
    
    /// <summary>
    /// Remet √† z√©ro les r√©sultats d'action pour recommencer la salle
    /// Permet au joueur de refaire ses choix dans la salle actuelle
    /// </summary>
    private void ResetRoom()
    {
        actionResult = "";
    }
}