@*
    Page principale de jeu
    Contient la logique d'interaction avec les salles de donjon
    GÃ¨re les actions : Combattre, Fuir, Fouiller
*@
@page "/game"

<div class="game-container">
    <h1>ğŸ° Salle de Jeu - Donjon ğŸ°</h1>
    
    <div class="game-status">
        <div class="player-stats">
            <h3>âš”ï¸ Ã‰tat du Joueur</h3>
            <p><strong>ğŸ‘¤ Nom :</strong> Aventurier</p>
            <p><strong>ğŸ’° Points :</strong> 0</p>
            <p><strong>ğŸšª Salle :</strong> 1 / 5</p>
        </div>
    </div>

    <div class="room-display">
        <div class="room-description">
            <h2>ğŸ° Salle 1 : L'EntrÃ©e du Donjon</h2>
            <div class="room-story">
                <p>Vous pÃ©nÃ©trez dans une salle humide aux murs de pierre ancienne. 
                   Des torches vacillantes projettent des ombres inquiÃ©tantes sur les murs couverts de mousse.</p>
                   
                <p>Soudain, un <strong>gobelin</strong> surgit des ombres, brandissant une Ã©pÃ©e rouillÃ©e !</p>
                
                <p class="encounter-text">ğŸ’€ <em>Un gobelin vous barre la route !</em></p>
            </div>
        </div>

        <div class="room-actions">
            <h3>âš¡ Que faites-vous ?</h3>
            
            <div class="action-buttons">
                <button class="btn btn-danger action-btn" @onclick="@(() => TakeAction("combat"))">
                    âš”ï¸ Combattre
                    <small>RisquÃ© mais plus de points</small>
                </button>
                
                <button class="btn btn-warning action-btn" @onclick="@(() => TakeAction("flee"))">
                    ğŸƒ Fuir
                    <small>SÃ»r mais moins de points</small>
                </button>
                
                <button class="btn btn-info action-btn" @onclick="@(() => TakeAction("search"))">
                    ğŸ” Fouiller
                    <small>Chance de trÃ©sor ou piÃ¨ge</small>
                </button>
            </div>
        </div>

        @if (!string.IsNullOrEmpty(actionResult))
        {
            <div class="action-result">
                <div class="alert alert-info">
                    <h4>RÃ©sultat de l'action :</h4>
                    <p>@actionResult</p>
                    
                    <div class="next-actions">
                        <button class="btn btn-primary" @onclick="NextRoom">
                            ğŸšª Passer Ã  la salle suivante
                        </button>
                        <button class="btn btn-secondary" @onclick="ResetRoom">
                            ğŸ”„ Refaire cette salle
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
</div>

@code {
    /// <summary>
    /// RÃ©sultat de la derniÃ¨re action effectuÃ©e par le joueur
    /// AffichÃ© dans la section des rÃ©sultats d'action
    /// </summary>
    private string actionResult = "";
    
    /// <summary>
    /// Traite l'action choisie par le joueur dans la salle de donjon
    /// </summary>
    /// <param name="action">Type d'action : "combat", "flee", ou "search"</param>
    private void TakeAction(string action)
    {
        // Traitement des diffÃ©rentes actions possibles
        switch (action.ToLower())
        {
            case "combat":
                // Action combattre : risquÃ© mais plus de points
                actionResult = "âš”ï¸ Vous attaquez le gobelin avec courage ! AprÃ¨s un combat acharnÃ©, vous le vainquez. Vous gagnez 15 points !";
                break;
            case "flee":
                // Action fuir : sÃ»r mais moins de points
                actionResult = "ğŸƒ Vous fuyez prudemment vers la sortie de la salle. Vous Ã©vitez le danger mais ne gagnez que 5 points.";
                break;
            case "search":
                // Action fouiller : chance de trÃ©sor ou piÃ¨ge
                actionResult = "ğŸ” Vous fouillez la salle et trouvez un coffre cachÃ© ! Ã€ l'intÃ©rieur, une potion de soin et 10 piÃ¨ces d'or. Vous gagnez 12 points !";
                break;
        }
    }
    
    /// <summary>
    /// Avance vers la salle suivante du donjon
    /// Version 1 : Affiche un message, fonctionnalitÃ© complÃ¨te Ã  venir en Version 2
    /// </summary>
    private void NextRoom()
    {
        actionResult = "ğŸšª Vous avancez vers la salle suivante... (FonctionnalitÃ© Ã  venir)";
    }
    
    /// <summary>
    /// Remet Ã  zÃ©ro les rÃ©sultats d'action pour recommencer la salle
    /// Permet au joueur de refaire ses choix dans la salle actuelle
    /// </summary>
    private void ResetRoom()
    {
        actionResult = "";
    }
}